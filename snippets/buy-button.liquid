<product-form
  class="product-form"
  data-hide-errors="{{ gift_card_recipient_feature_active }}"
  data-section-id="{{ section.id }}"
>
  <div class="product-form__error-message-wrapper" role="alert" hidden>
    <span class="svg-wrapper">
      {{- 'icon-error.svg' | inline_asset_content -}}
    </span>
    <span class="product-form__error-message"></span>
  </div>

  {%- form 'product',
    product,
    id: product_form_id,
    class: 'form',
    novalidate: 'novalidate',
    data-type: 'add-to-cart-form',
    data-custom-modal-form: 'form'
  -%}
    <input
      type="hidden"
      name="id"
      value="{{ product.selected_or_first_available_variant.id }}"
      {% if product.selected_or_first_available_variant.available == false
        or quantity_rule_soldout
        or product.selected_or_first_available_variant == null
      %}
        disabled
      {% endif %}
      class="product-variant-id"
    >

    {%- if gift_card_recipient_feature_active -%}
      {%- render 'gift-card-recipient-form', product: product, form: form, section: section -%}
    {%- endif -%}

    <div class="product-form__buttons">
      {%- liquid
        assign check_against_inventory = true
        if product.selected_or_first_available_variant.inventory_management != 'shopify' or product.selected_or_first_available_variant.inventory_policy == 'continue'
          assign check_against_inventory = false
        endif
        if product.selected_or_first_available_variant.quantity_rule.min > product.selected_or_first_available_variant.inventory_quantity and check_against_inventory
          assign quantity_rule_soldout = true
        endif
      -%}
      <button
        id="ProductSubmitButton-{{ section_id }}"
        type="submit"
        name="add"
        class="product-form__submit button button--full-width {% if show_dynamic_checkout %}button--secondary{% else %}button--primary{% endif %}"
        data-custom-modal-button
        {% if product.selected_or_first_available_variant.available == false
          or quantity_rule_soldout
          or product.selected_or_first_available_variant == null
        %}
          disabled
        {% endif %}
      >
        <span>
          {%- if product.selected_or_first_available_variant == null -%}
            {{ 'products.product.unavailable' | t }}
          {%- elsif product.selected_or_first_available_variant.available == false
            or quantity_rule_soldout
          -%}
            {{ 'products.product.sold_out' | t }}
          {%- else -%}
            {{ 'products.product.continue_to_the_cart' | t }}
          {%- endif -%}
        </span>
        {%- render 'loading-spinner' -%}
      </button>
    </div>
  {%- endform -%}
</product-form>